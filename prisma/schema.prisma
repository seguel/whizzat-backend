datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

enum PerfilTipo {
  CANDIDATO
  RECRUTADOR
  AVALIADOR
}

enum TipoNotificacao {
  NOVA_SKILL
  NOVA_MENSAGEM
  NOVA_AVALIACAO
  CADASTRO_AVALIADOR
}

model Usuario {
  id              Int @id @default(autoincrement())
  primeiro_nome   String
  ultimo_nome     String
  email           String @unique
  senha           String
  id_perfil       Int?
  ativo           Boolean @default(false)
  createdAt       DateTime @default(now())
  linguagem       String
  data_nascimento DateTime
  genero_id       Int
  nome_social     String?
  cidade_id       Int

  avaliador  UsuarioPerfilAvaliador[]
  recrutador UsuarioPerfilRecrutador[]
  candidato  UsuarioPerfilCandidato[]
  genero     Genero       @relation(fields: [genero_id], references: [id])
  cidade     EstadoCidade @relation(fields: [cidade_id], references: [id])
  notificacao Notificacao[]

  @@map("usuario")
}

model Perfil {
  id        Int @id @default(autoincrement())
  perfil    String
  descricao String
  ativo     Boolean @default(true)

  avaliador UsuarioPerfilAvaliador[]
  recrutador UsuarioPerfilRecrutador[]
  candidato UsuarioPerfilCandidato[]
  usuario_perfil UsuarioPerfil[]

  @@map("perfil")
}

model UsuarioPerfilRecrutador {
  id               Int @id @default(autoincrement())
  usuario_id       Int
  perfil_id        Int
  telefone         String
  localizacao      String?
  apresentacao     String
  logo             String
  meio_notificacao String
  data_cadastro    DateTime @default(now())
  ativo            Boolean @default(true)
  linguagem        String

  usuario  Usuario @relation(fields: [usuario_id], references: [id])
  perfil   Perfil  @relation(fields: [perfil_id], references: [id])
  empresas Empresa[]

  @@unique([usuario_id, perfil_id])
  @@map("usuario_perfil_recrutador")
}

model UsuarioPerfilAvaliador {
  id                Int @id @default(autoincrement())
  usuario_id        Int
  perfil_id         Int
  empresa_id        Int?
  telefone          String
  localizacao       String?
  apresentacao      String
  logo              String
  avaliar_todos     Boolean @default(false)
  meio_notificacao  String
  data_cadastro     DateTime @default(now())
  ativo             Boolean @default(true)
  status_cadastro   Int @default(-1)
  data_envio_link   DateTime @default(now())
  linguagem         String
  pontos            Int @default(10)
  liberado_avaliar  Boolean @default(false)

  usuario             Usuario @relation(fields: [usuario_id], references: [id])
  perfil              Perfil  @relation(fields: [perfil_id], references: [id])
  empresa             Empresa? @relation(fields: [empresa_id], references: [id])
  skills              AvaliadorSkill[]
  formacao            AvaliadorFormacaoAcademica[]
  certificacoes       AvaliadorCertificacoes[]
  avaliacoesCandidato CandidatoAvaliacaoSkill[]
  avaliadorRanking    AvaliadorRankingAvaliacao[]
  avaliacaoSkill      AvaliadorAvaliacaoSkill[]

  @@unique([usuario_id, perfil_id])
  @@index([ativo, avaliar_todos, liberado_avaliar, linguagem])
  @@map("usuario_perfil_avaliador")
}

model AvaliadorSkill {
  id             Int @id @default(autoincrement())
  avaliador_id   Int
  skill_id       Int
  peso           Int
  favorito       Boolean
  tempo_favorito String

  avaliador UsuarioPerfilAvaliador @relation(fields: [avaliador_id], references: [id])
  skill     Skill                  @relation(fields: [skill_id], references: [skill_id])

  @@index([skill_id])
  @@map("avaliador_skill")
}

model AvaliadorFormacaoAcademica {
  id               Int @id @default(autoincrement())
  avaliador_id     Int
  graduacao_id     Int
  formacao         String
  certificado_file String

  avaliador UsuarioPerfilAvaliador @relation(fields: [avaliador_id], references: [id])
  graduacao Graduacao               @relation(fields: [graduacao_id], references: [id])

  @@map("avaliador_formacao_academica")
}

model AvaliadorCertificacoes {
  id               Int @id @default(autoincrement())
  avaliador_id     Int
  certificacao_id  Int
  certificado_file String

  avaliador     UsuarioPerfilAvaliador @relation(fields: [avaliador_id], references: [id])
  certificacoes Certificacoes           @relation(fields: [certificacao_id], references: [id])

  @@map("avaliador_certificacoes")
}

model UsuarioPerfilCandidato {
  id               Int @id @default(autoincrement())
  usuario_id       Int
  perfil_id        Int
  telefone         String
  localizacao      String?
  apresentacao     String
  logo             String
  meio_notificacao String
  data_cadastro    DateTime @default(now())
  ativo            Boolean @default(true)
  linguagem        String

  usuario       Usuario @relation(fields: [usuario_id], references: [id])
  perfil        Perfil  @relation(fields: [perfil_id], references: [id])
  skills        CandidatoSkill[]
  formacao      CandidatoFormacaoAcademica[]
  certificacoes CandidatoCertificacoes[]

  @@unique([usuario_id, perfil_id])
  @@map("usuario_perfil_candidato")
}

model CandidatoSkill {
  id             Int @id @default(autoincrement())
  candidato_id   Int
  skill_id       Int
  peso           Int
  favorito       Boolean
  tempo_favorito String
  data_ultima_avaliacao DateTime?
  peso_avaliador Int?

  candidato UsuarioPerfilCandidato @relation(fields: [candidato_id], references: [id])
  skill     Skill                  @relation(fields: [skill_id], references: [skill_id])
  avaliacoes CandidatoAvaliacaoSkill[]

  @@map("candidato_skill")
}

model CandidatoFormacaoAcademica {
  id               Int @id @default(autoincrement())
  candidato_id     Int
  graduacao_id     Int
  formacao         String
  certificado_file String

  candidato UsuarioPerfilCandidato @relation(fields: [candidato_id], references: [id])
  graduacao Graduacao               @relation(fields: [graduacao_id], references: [id])

  @@map("candidato_formacao_academica")
}

model CandidatoCertificacoes {
  id               Int @id @default(autoincrement())
  candidato_id     Int
  certificacao_id  Int
  certificado_file String

  candidato     UsuarioPerfilCandidato @relation(fields: [candidato_id], references: [id])
  certificacoes Certificacoes           @relation(fields: [certificacao_id], references: [id])

  @@map("candidato_certificacoes")
}

model Empresa {
  id            Int @id @default(autoincrement())
  recrutador_id Int
  nome_empresa  String
  website       String
  email         String
  telefone      String
  localizacao   String?
  apresentacao  String
  logo          String
  imagem_fundo  String
  data_cadastro DateTime @default(now())
  ativo         Boolean @default(true)
  linguagem     String
  cidade_id     Int

  recrutador UsuarioPerfilRecrutador @relation(fields: [recrutador_id], references: [id])
  vagas       EmpresaVaga[] @relation("EmpresaVagas")
  avaliadores UsuarioPerfilAvaliador[]
  cidade      EstadoCidade @relation(fields: [cidade_id], references: [id])

  @@map("empresa")
}

model EmpresaVaga {
  vaga_id                Int @id @default(autoincrement())
  empresa_id             Int
  nome_vaga              String
  descricao              String
  local_vaga             String?
  modalidade_trabalho_id Int
  periodo_trabalho_id    Int
  pcd                    Boolean
  lgbtq                  Boolean @default(false)
  mulheres               Boolean @default(false)
  cinquenta_mais         Boolean @default(false)
  qtde_dias_aberta       Int
  qtde_posicao           Int
  data_cadastro          DateTime @default(now())
  ativo                  Boolean @default(true)
  cidade_id              Int

  modalidade_trabalho ModalidadeTrabalho @relation(fields: [modalidade_trabalho_id], references: [modalidade_trabalho_id])
  periodo_trabalho    PeriodoTrabalho    @relation(fields: [periodo_trabalho_id], references: [periodo_trabalho_id])
  skills              EmpresaVagaSkill[]
  cidade              EstadoCidade @relation(fields: [cidade_id], references: [id])
  empresa             Empresa @relation("EmpresaVagas", fields: [empresa_id], references: [id])

  @@map("empresa_vaga")
}

model EmpresaVagaSkill {
  id                Int @id @default(autoincrement())
  vaga_id           Int
  skill_id          Int
  peso              Int
  avaliador_proprio Boolean

  vaga  EmpresaVaga @relation(fields: [vaga_id], references: [vaga_id])
  skill Skill       @relation(fields: [skill_id], references: [skill_id])

  @@map("empresa_vaga_skill")
}

model TipoSkill {
  id         Int @id @default(autoincrement())
  tipo_Skill String

  skills Skill[]

  @@map("tipo_skill")
}

model Skill {
  skill_id      Int @id @default(autoincrement())
  skill         String @unique
  tipo_skill_id Int
  ativo         Boolean @default(true)
  linguagem     String

  vagas       EmpresaVagaSkill[]
  avaliadores AvaliadorSkill[]
  candidato   CandidatoSkill[]
  tipo_skill  TipoSkill @relation(fields: [tipo_skill_id], references: [id])

  @@map("skill")
}

model ModalidadeTrabalho {
  modalidade_trabalho_id Int @id @default(autoincrement())
  modalidade             String
  ativo                  Boolean
  linguagem              String

  vagas EmpresaVaga[]

  @@map("modalidade_trabalho")
}

model PeriodoTrabalho {
  periodo_trabalho_id Int @id @default(autoincrement())
  periodo             String
  ativo               Boolean
  linguagem           String

  vagas EmpresaVaga[]

  @@map("periodo_trabalho")
}

model Certificacoes {
  id          Int @id @default(autoincrement())
  certificado String @unique
  ativo       Boolean @default(true)
  linguagem   String

  avaliadores_certificado AvaliadorCertificacoes[]
  candidato_certificado   CandidatoCertificacoes[]

  @@map("certificacoes")
}

model Graduacao {
  id        Int @id @default(autoincrement())
  graduacao String
  ativo     Boolean @default(true)
  linguagem String

  avaliadores_formacao AvaliadorFormacaoAcademica[]
  candidatos_formacao  CandidatoFormacaoAcademica[]

  @@map("graduacao")
}

model Genero {
  id        Int @id @default(autoincrement())
  genero    String
  ativo     Boolean @default(true)
  linguagem String

  usuario Usuario[]

  @@map("genero")
}

model Estado {
  id        Int @id @default(autoincrement())
  estado    String
  sigla     String
  linguagem String

  cidade EstadoCidade[]

  @@map("estado")
}

model EstadoCidade {
  id        Int @id @default(autoincrement())
  estado_id Int
  cidade    String
  cep       String?

  estado  Estado @relation(fields: [estado_id], references: [id])
  usuario Usuario[]
  empresa Empresa[]
  vaga    EmpresaVaga[]

  @@unique([estado_id, cidade])
  @@map("estado_cidade")
}

model Plano {
  id        Int @id @default(autoincrement())
  plano     String
  ativo     Boolean @default(true)
  highlight Boolean @default(false)

  periodos  PlanoPeriodo[]
  itens     PlanoItens[]
  linguagem PlanoLinguagem[]

  @@map("plano")
}

model PlanoLinguagem {
  id        Int @id @default(autoincrement())
  plano_id  Int
  plano     String
  descricao String?
  linguagem String

  planos Plano @relation(fields: [plano_id], references: [id])

  @@map("plano_linguagem")
}

model PlanoItens {
  id        Int @id @default(autoincrement())
  plano_id  Int
  descricao String
  ordem     Int
  linguagem String

  plano Plano @relation(fields: [plano_id], references: [id])

  @@map("plano_itens")
}

model PlanoPeriodo {
  id            Int @id @default(autoincrement())
  plano_id      Int
  periodo       String
  validade_dias Int
  valor         Decimal @db.Decimal(10,2)
  ativo         Boolean @default(true)
  perfil_id     Int @default(0)
  valor_old     Decimal? @db.Decimal(10,2)
  desconto      Int?

  plano         Plano @relation(fields: [plano_id], references: [id])
  usuario_plano UsuarioPerfilPlano[]

  @@map("plano_periodo")
}

model UsuarioPerfil {
  id         Int @id @default(autoincrement())
  usuario_id Int
  perfil_id  Int

  perfil Perfil @relation(fields: [perfil_id], references: [id])
  planos UsuarioPerfilPlano[]

  @@unique([usuario_id, perfil_id])
  @@map("usuario_perfil")
}

model UsuarioPerfilPlano {
  id                Int @id @default(autoincrement())
  usuario_perfil_id Int @unique
  plano_periodo_id  Int
  data_inicio       DateTime @default(now())
  ativo             Boolean @default(false)
  pagto_pendente    Boolean @default(true)

  usuario_perfil UsuarioPerfil @relation(fields: [usuario_perfil_id], references: [id])
  periodo        PlanoPeriodo @relation(fields: [plano_periodo_id], references: [id])
  pagto_log      PlanoPagtoLog[]

  @@map("usuario_perfil_plano")
}

model PlanoPagtoLog {
  id                      Int @id @default(autoincrement())
  usuario_perfil_plano_id Int
  transacao_id            String @unique
  data_pagto              DateTime @default(now())
  valor                   Decimal @db.Decimal(10,2)
  status                  String

  usuario_plano UsuarioPerfilPlano @relation(fields: [usuario_perfil_plano_id], references: [id])

  @@map("plano_pagto_log")
}

model CandidatoAvaliacaoSkill {
  id                    Int @id @default(autoincrement())
  candidato_skill_id    Int
  data_avaliacao        DateTime?
  avaliacao_pendente    Boolean @default(true)
  prioridade_ordem      Int
  reavaliar             Boolean @default(false)
  data_pedido_reavaliar DateTime?
  avaliador_id          Int?
  linguagem             String

  candidatoSkill   CandidatoSkill @relation(fields: [candidato_skill_id], references: [id])
  avaliador         UsuarioPerfilAvaliador? @relation(fields: [avaliador_id], references: [id])
  avaliadorRanking AvaliadorRankingAvaliacao[]
  avaliacaoSkill   AvaliadorAvaliacaoSkill[]

  @@map("candidato_avaliacao_skill")
}

model AvaliadorRankingAvaliacao {
  id                 Int @id @default(autoincrement())
  avaliador_id       Int
  avaliacao_skill_id Int
  data_convite       DateTime @default(now())
  data_expiracao     DateTime
  aceite             Boolean? 
  data_aceite_recusa DateTime?
  

  candidatoSkill  CandidatoAvaliacaoSkill @relation(fields: [avaliacao_skill_id], references: [id])
  avaliador       UsuarioPerfilAvaliador @relation(fields: [avaliador_id], references: [id])

  @@unique([avaliador_id, avaliacao_skill_id])
  @@index([avaliacao_skill_id])
  @@index([avaliador_id])
  @@index([aceite])
  @@index([data_expiracao])

  @@map("avaliador_ranking_avaliacao")
}

model AvaliadorAvaliacaoSkill {
  id                 Int @id @default(autoincrement())
  avaliador_id       Int
  avaliacao_skill_id Int
  data_avaliacao     DateTime?
  peso               Int? 
  comentario         String?
  data_aceite        DateTime @default(now())

  candidatoSkill  CandidatoAvaliacaoSkill @relation(fields: [avaliacao_skill_id], references: [id])
  avaliador       UsuarioPerfilAvaliador @relation(fields: [avaliador_id], references: [id])

  @@map("avaliador_avaliacao_skill")
}

model Notificacao {
  id              Int      @id @default(autoincrement())  
  usuario_id      Int
  perfil_tipo     PerfilTipo
  perfil_id       Int  
  tipo            TipoNotificacao
  referencia_id   Int?  
  titulo          String
  mensagem        String  
  lida            Boolean  @default(false)
  enviada_email   Boolean  @default(false)  
  criado_em       DateTime @default(now())

  usuario Usuario @relation(fields: [usuario_id], references: [id])

  @@index([usuario_id, perfil_tipo])
  @@index([usuario_id, perfil_tipo, lida])
  @@index([usuario_id, lida])
  @@index([enviada_email])
  @@unique([perfil_tipo, usuario_id, tipo, referencia_id])
  @@map("notificacao")
}
